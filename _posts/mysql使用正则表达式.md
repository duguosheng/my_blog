---
title: mysql使用正则表达式
date: 2020-04-08 13:12:45
tags:
- 正则表达式
categories:
- 数据库
description:
- 使用REGEXP关键字可以在mysql中使用正则表达式进行检索
---

<!--more-->

## REGEXP关键字
使用`REGEXP`表示后面跟着的是正则表达式
如下例
```sql
SELECT prod_name FROM products WHERE prod_name REGEXP '.000' ORDER BY prod_name;
```

其中`.`表示匹配任意一个字符

### 与LIKE的区别
* `LIKE`匹配整个列，而`REGEXP`在列值内匹配
* 可以在正则表达式中使用`^`和`$`限定开头结尾来达到`LIKE`的效果

## mysql中的正则表达式

### 进行OR匹配
使用`|`符号，可以进行多个`OR`条件匹配
如下例
`REGEXP 100|200|300`，匹配`100`，`200`，`300`中的任意一个
`REGEXP 1|2|3 abc`匹配的不是`1 abc`，`2 abc`或`3 abc`，而是`1`，`2`或`3 abc`中的一个，如果想要限定只选择`123`中的一个，可以使用`[]`将其括起来形成一个集合

### 字符集合
上例中，可以使用`[1|2|3] Ton`达到效果，或者可以在集合中省略`|`，写成`[123] Ton`
* 省略写法
`[0-9]`表示0-9之间的数字
`[a-z]`小写的a-z之间所有字母
类似的：`[1-7]``[A-M]``[0-7b-kB-K]`

* 字符集合的否定
在集合开始加上`^`表示将匹配指定字符外的任何东西
`[123]`表示`123`中的一个字符，`[^123]`表示除了`123`之外的字符

### 匹配特殊字符
使用转义字符`\`将具有特殊含义的字符转义回来，或将普通字符转成其他含义
如`\\.`匹配字符`.`，类似的，要匹配`[]``|``\`前面都要加两个`\`
`\\f`表示换页，`\\\n`换行，`\\r`回车，`\\t`制表，`\\v`纵向制表

> 说明：多数正则表达式使用单个`\`转义，而mysql中要使用两个，mysql自己解释一个，正则表达式库解释另一个

### 匹配字符类

| 类           | 说明                                        |
|--------------|---------------------------------------------|
| `[:alnum:]`  | 任意字母数字，同[0-9a-zA-Z]                 |
| `[:alpha:]`  | 任意字母，同[a-zA-Z]                        |
| `[:blank:]`  | 空格和制表，同`[\\t]`                       |
| `[:cntrl:]`  | ASCII控制字符，ASCII0-31和127               |
| `[:digit:]`  | 任意数字[0-9]                               |
| `[:print:]`  | 任意可打印字符                              |
| `[:graph:]`  | 同上，但不包含空格                          |
| `[:lower:]`  | [a-z]                                       |
| `[:upper:]`  | [A-Z]                                       |
| `[:punct:]`  | 既不在[:alnum:]又不在[:cntrl:]中的任意字符  |
| `[:space:]`  | 包括空格的任意空白字符，`[\\t\\v\\f\\n\\r]` |
| `[:xdigit:]` | 任意十六进制数字，[a-fA-F0-9]               |

### 匹配多个字符

| 元字符   | 说明                     |
|----------|--------------------------|
| `*`      | 0或多个                  |
| `+`      | 1或多个                  |
| `?`      | 0或1个                   |
| `{n}`    | 匹配n个                  |
| `{n, }`  | 匹配n个或以上            |
| `{n, m}` | 匹配n到m个，m不能大于255 |

`apples?`匹配`apple`或`apples`
`[0-9]{2, }`匹配2个以上的数字
`[[:alpha:]]{1,5}`匹配1-5个字母

### 定位符

| 元字符    | 含义     |
|-----------|----------|
| `^`       | 文本开始 |
| `$`       | 文本结束 |
| `[[:<:]]` | 词的开头 |
| `[[:>:]]` | 词的结尾 |

`^[0-9\\.]`匹配文本开始的0-9或字符`.`


## 测试正则表达式
可以在不使用数据库表的情况下测试正则表达式，`REGEXP`总是返回0(未匹配)或1(匹配成功)
```sql
SELECT 'hello' REGEXP '[0-9]';
```

显然将返回0
